{% extends 'equestria/base.html' %}
{% load static %}

{% block title %}
    Equestria: Upload files
{% endblock %}

{% block header %}
    {% include 'equestria/header.html' with active="upload" %}
	
{% endblock %}

{% block body %}
    <div class="container">
        <div class="rounded lighter padding">
            <h1>Upload files</h1>
            {% if upload_form %}
                <h3>Upload your files {% if extensions %}({% for extension in extensions %}.{{ extension }}{% if not forloop.last %}, {% endif %}{% endfor %}){% endif %}:</h3>
                <form class="md-form" action="{% url 'upload:upload_project' project=project %}" method="post" enctype="multipart/form-data">
                    <div class="mb-3">
                        <div class="custom-file">
                            {{ upload_form }}
                            {% csrf_token %}
                            <input type="submit" value="Upload files" class="btn btn-primary">
                        </div>
                    </div>
                </form>
            {% endif %}
            {% if can_start %}
                <a class="btn btn-primary" href="{% url "scripts:start_automatic" project=project script=project.pipeline.fa_script %}">Start FA</a>
            {% else %}
                <p class="alert alert-danger">There is currently a running process. You cannot start a new process.
                    First, wait for the current process to finish and reload this page.</p>
                {% include 'scripts/project-continue.html' with project=project %}
            {% endif %}
            {% if removed_list %}
                <p class="mt-3"><strong>Warning! Some files you tried to upload had the wrong extension and are therefore not saved. The following files
                have been discarded:</strong></p>
                <ul>
                    {% for file in removed_list %}
                        <li>{{ file }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
    </div>
    <br />
	<div class="container">
		<div class="rounded lighter padding">
            {% if files %}
                <h2> Uploaded files: </h2>
                {% for file in files %}
                    <p id="fileid_{{ forloop.counter }}"> {{ file }} 
                         <button class="btn-sm btn-danger" id="button" counter="{{ forloop.counter }}" file="{{ file }}">Delete</button>
                    </p>
                {% endfor %}
            {% else %}
                <p> No files have been uploaded yet </p>
            {% endif %}
		</div>
	</div>
{% endblock %}
{% block scripts %}
<script>
	    $(document).ready(function(){
	        $("button").click(function(){
	        	var file = $(this).attr('file');
                var counter = $(this).attr('counter');
                var filepara = document.getElementById("fileid_"+counter);
                filepara.style.display = 'none';
	        	$.ajax({
			      	url: "{% url 'upload:delete_file' project=project %}",
			      	data: { csrfmiddlewaretoken: "{{ csrf_token }}",
            				file:file,
          			},
			      	type: 'post',
			    });
	        });
	    });
	</script>
{% endblock %}

